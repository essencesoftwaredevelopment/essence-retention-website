<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ESSENCE Retention</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/locomotive-scroll@4.1.4/dist/locomotive-scroll.min.css" />
</head>
<body>
  <div class="cursor" id="custom-cursor" aria-hidden="true"></div>
  <div class="page-grid" data-scroll-container>
    <header class="site-header" data-scroll-section>
      <div class="site-header__logo">ESSENCE Retention</div>
      <nav class="site-header__nav">
        <a class="site-header__link" href="#hero">Overview</a>
        <a class="site-header__link" href="#tri-catalyst">System</a>
        <a class="button button--primary site-header__cta" href="https://calendly.com/essencesoftwaredevelopment/discovery-call">Book a demo</a>
      </nav>
    </header>

    <main data-scroll-section>
      <section class="hero" id="hero">
        <div class="hero__content">
          <!-- <p class="eyebrow">Klaviyo + Shopify Partners</p> -->
          <h1 class="hero__title">
            <span class="hero__title-accent" style="font-style: italic; font-weight: 50;">Hyper-Performant</span>
            <br />Ecommerce Retention
          </h1>
          <!-- Subheading -->
            <div class="hero__subhead-row" style="display: flex; align-items: center; justify-content: center; gap: 5px;">
            <div class="hero__stars" style="display: flex; gap: 0.25rem;">
              <span style="color: #fbbf24; font-size: 1rem;">★</span>
              <span style="color: #fbbf24; font-size: 1rem;">★</span>
              <span style="color: #fbbf24; font-size: 1rem;">★</span>
              <span style="color: #fbbf24; font-size: 1rem;">★</span>
              <span style="color: #fbbf24; font-size: 1rem;">★</span>
            </div>
            <p class="hero__subhead" style="text-align: center;">
              "The next generation of ecommerce retention systems."
            </p>
            </div>
          <!-- Hero Badges -->
          <div class="hero__badges">
            <div class="hero__logos">
              <img src="assets/images/klaviyo-partners.png" alt="Klaviyo Platinum Partner badge" class="hero__logo" />
              <img src="assets/images/shopify-partners.png" alt="Shopify Plus Partner badge" class="hero__logo" />
            </div>
            <div class="hero__chip">11.2X AVG. ROI</div>
          </div>
          <!-- Loom Video Placeholder -->
          <div class="hero__video-placeholder">
            <div class="hero__video-embed" data-video-embed>
              <div class="hero__video-guard" data-video-guard>
                <button type="button" class="hero__video-play">
                  <span class="hero__video-play-icon">▶</span>
                  Watch overview
                </button>
                <span class="hero__video-hint">Scroll stays active under your cursor</span>
              </div>
              <iframe
                src="https://www.loom.com/embed/038fa6f0844241f18506ea515b9d3de8"
                frameborder="0"
                allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"
                allowfullscreen
              ></iframe>
            </div>
          </div>
           
          <div class="hero__actions">
            <a class="button button--primary" href="https://calendly.com/essencesoftwaredevelopment/discovery-call">Book a demo</a>
            <a class="button button--ghost" href="#tri-catalyst">See the system</a>
          </div>
        </div>
      </section>

      <section class="flow-visual" id="tri-catalyst">
        <div class="flow-visual__grid" aria-hidden="true"></div>
        <div class="flow-visual__layout">
          <div class="flow-visual__animation" id="animation-container">
            <canvas id="line-canvas"></canvas>
            <div class="flow-visual__boxes">
              <div class="component-box" id="box-1">
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" />
                  <circle cx="9" cy="7" r="4" />
                  <path d="M22 21v-2a4 4 0 0 0-3-3.87" />
                  <path d="M16 3.13a4 4 0 0 1 0 7.75" />
                </svg>
                <div class="component-label">Capture</div>
              </div>

              <div class="component-box" id="box-2">
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <path d="M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z" />
                  <path d="M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z" />
                  <path d="M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4" />
                  <path d="M17.599 6.5a3 3 0 0 0 .399-1.375" />
                  <path d="M6.003 5.125A3 3 0 0 0 6.401 6.5" />
                  <path d="M3.477 10.896a4 4 0 0 1 .585-.396" />
                  <path d="M19.938 10.5a4 4 0 0 1 .585.396" />
                  <path d="M6 18a4 4 0 0 1-1.954-1.297" />
                  <path d="M19.954 16.703A4 4 0 0 1 18 18" />
                </svg>
                <div class="component-label">Convert</div>
              </div>

              <div class="component-box" id="box-3">
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <polyline points="22 7 13.5 15.5 8.5 10.5 2 17" />
                  <polyline points="16 7 22 7 22 13" />
                  <circle cx="12" cy="12" r="8" opacity="0" />
                  <path d="M16 16c0 1.1-.9 2-2 2h-4c-1.1 0-2-.9-2-2V8c0-1.1.9-2 2-2h4c1.1 0 2 .9 2 2v8z" style="opacity:0;" />
                </svg>
                <div class="component-label">Retain</div>
              </div>
            </div>
          </div>
          <aside class="flow-detail-list" id="flow-detail-list"></aside>
        </div>
      </section>

      <section class="email-marquee">
        <div class="email-marquee__inner">
          <h2 class="email-marquee__title">Impeccible Designs</h2>
          <div class="email-marquee__viewport">
            <div class="email-marquee__track">
              <img
                src="https://cdn.prod.website-files.com/65a27a6353a920f4f8feb14a/681cf8aa1ed1dbd9245d9f35_Your%20Vision%20Deserves%20the%20Best.png"
                alt=""
                class="email-marquee__image"
              />
              <img
                src="https://cdn.prod.website-files.com/65a27a6353a920f4f8feb14a/681cf8a9310e45831c42a2ac_WM1.png"
                alt=""
                class="email-marquee__image"
              />
              <img
                src="https://cdn.prod.website-files.com/65a27a6353a920f4f8feb14a/681cf8a9372933b3b5ead9c9_Frame%203.png"
                alt=""
                class="email-marquee__image"
              />
              <img
                src="https://cdn.prod.website-files.com/65a27a6353a920f4f8feb14a/681cf8a9c919019936f292ca_7%20Days%20Out.png"
                alt=""
                class="email-marquee__image"
              />
              <img
                src="https://cdn.prod.website-files.com/65a27a6353a920f4f8feb14a/681cf8a9058a32d099acb069_Frame%202.png"
                alt=""
                class="email-marquee__image"
              />
              <img
                src="https://cdn.prod.website-files.com/65a27a6353a920f4f8feb14a/681cf8a6c880971c89a0db51_Aer.png"
                alt=""
                class="email-marquee__image"
              />
              <img
                src="https://cdn.prod.website-files.com/65a27a6353a920f4f8feb14a/681cf8a9191229924bce4026_Email.png"
                alt=""
                class="email-marquee__image"
              />

              <img
                src="https://cdn.prod.website-files.com/65a27a6353a920f4f8feb14a/681cf8aa1ed1dbd9245d9f35_Your%20Vision%20Deserves%20the%20Best.png"
                alt=""
                class="email-marquee__image"
              />
              <img
                src="https://cdn.prod.website-files.com/65a27a6353a920f4f8feb14a/681cf8a9310e45831c42a2ac_WM1.png"
                alt=""
                class="email-marquee__image"
              />
              <img
                src="https://cdn.prod.website-files.com/65a27a6353a920f4f8feb14a/681cf8a9372933b3b5ead9c9_Frame%203.png"
                alt=""
                class="email-marquee__image"
              />
              <img
                src="https://cdn.prod.website-files.com/65a27a6353a920f4f8feb14a/681cf8a9c919019936f292ca_7%20Days%20Out.png"
                alt=""
                class="email-marquee__image"
              />
              <img
                src="https://cdn.prod.website-files.com/65a27a6353a920f4f8feb14a/681cf8a9058a32d099acb069_Frame%202.png"
                alt=""
                class="email-marquee__image"
              />
              <img
                src="https://cdn.prod.website-files.com/65a27a6353a920f4f8feb14a/681cf8a6c880971c89a0db51_Aer.png"
                alt=""
                class="email-marquee__image"
              />
              <img
                src="https://cdn.prod.website-files.com/65a27a6353a920f4f8feb14a/681cf8a9191229924bce4026_Email.png"
                alt=""
                class="email-marquee__image"
              />
            </div>
          </div>
        </div>
      </section>

      <section class="revenue-banner">
        <div class="revenue-banner__inner">
          <h2 class="revenue-banner__title">Over $2,700,000 generated for our clients</h2>
        </div>
      </section>

      <section class="results" id="results">
        <div class="results__inner">
          <div>
            <p class="results__eyebrow">Results</p>
            <h2 class="results__title">34.4% avg. revenue driven by our systems</h2>
            <p class="results__copy">
              Essence builds retention engines that compound LTV—no extra paid spend. We track contribution by cohort, campaign,
              and SKU to prove lift.
            </p>
          </div>
          <div class="results__stats">
            <div class="results__stat">
              <div class="results__stat-value">12.48x</div>
              <div class="results__stat-label">Spicy Wear ROI</div>
            </div>
            <div class="results__stat">
              <div class="results__stat-value">34.4%</div>
              <div class="results__stat-label">Retention contribution</div>
            </div>
            <div class="results__stat">
              <div class="results__stat-value">90 days</div>
              <div class="results__stat-label">To unlock lift</div>
            </div>
          </div>
        </div>
      </section>

    </main>

    <footer class="site-footer" data-scroll-section>
      <p>© <span id="year"></span> Essence Software Development. All rights reserved.</p>
      <a href="mailto:jacques@essencesoftwaredevelopment.com">jacques@essencesoftwaredevelopment.com</a>
    </footer>
  </div>

  <script>
    const yearEl = document.getElementById('year');
    if (yearEl) {
      yearEl.textContent = new Date().getFullYear();
    }
  </script>
  <script>
    (function initCustomCursor() {
      const cursor = document.getElementById('custom-cursor');
      if (!cursor) return;
      const isCoarse = window.matchMedia('(pointer: coarse)').matches;
      if (isCoarse) {
        cursor.style.display = 'none';
        return;
      }

      document.body.classList.add('has-custom-cursor');
      let x = window.innerWidth / 2;
      let y = window.innerHeight / 2;
      let targetX = x;
      let targetY = y;
      const ease = 0.18;
      let rafId = null;

      function update() {
        const dx = targetX - x;
        const dy = targetY - y;
        x += dx * ease;
        y += dy * ease;
        cursor.style.transform = `translate3d(${x}px, ${y}px, 0) translate(-50%, -50%)`;
        rafId = requestAnimationFrame(update);
      }

      function handleMove(event) {
        targetX = event.clientX;
        targetY = event.clientY;
        cursor.classList.add('is-visible');
        if (!rafId) rafId = requestAnimationFrame(update);
      }

      window.addEventListener('pointermove', handleMove, { passive: true });
    })();
  </script>
  <script>
    (function enableLoomScrollThrough() {
      const embed = document.querySelector('[data-video-embed]');
      if (!embed) return;
      const guard = embed.querySelector('[data-video-guard]');
      const iframe = embed.querySelector('iframe');
      if (!guard || !iframe) return;

      guard.addEventListener('click', () => {
        embed.classList.add('is-interactive');
        iframe.focus();
      });

      embed.addEventListener('mouseleave', () => {
        embed.classList.remove('is-interactive');
      });
    })();
  </script>
  <script src="https://cdn.jsdelivr.net/npm/locomotive-scroll@4.1.4/dist/locomotive-scroll.min.js"></script>
  <script>
    const scrollContainer = document.querySelector('[data-scroll-container]');
    if (scrollContainer) {
      const locoScroll = new LocomotiveScroll({
        el: scrollContainer,
        smooth: true,
        multiplier: 1,
        smartphone: { smooth: true },
        tablet: { smooth: true },
      });

      window.__locoScroll = locoScroll;
      locoScroll.on('scroll', (args) => {
        window.dispatchEvent(new CustomEvent('loco-scroll', { detail: args }));
      });

      window.addEventListener('resize', () => {
        locoScroll.update();
      });
    }

    (function setupAnchorScroll() {
      const anchorLinks = document.querySelectorAll('a[href^="#"]');
      if (!anchorLinks.length) return;

      anchorLinks.forEach((link) => {
        link.addEventListener('click', (event) => {
          const hash = link.getAttribute('href');
          if (!hash || hash === '#') return;
          const target = document.querySelector(hash);
          if (!target) return;
          event.preventDefault();

          if (window.__locoScroll && typeof window.__locoScroll.scrollTo === 'function') {
            window.__locoScroll.scrollTo(target, { offset: -40, duration: 800, disableLerp: true });
          } else {
            target.scrollIntoView({ behavior: 'smooth', block: 'start' });
          }

          if (history.pushState) {
            history.pushState(null, '', hash);
          } else {
            location.hash = hash;
          }
        });
      });
    })();
  </script>
  <script>
    (function initTriCatalystAnimation() {
      const container = document.getElementById('animation-container');
      const canvas = document.getElementById('line-canvas');
      if (!container || !canvas) return;

      const MAIN_THEME_COLOR = '#FFFFFF';
      const ctx = canvas.getContext('2d');
      const boxes = Array.from(container.querySelectorAll('.component-box'));
      if (!boxes.length) return;

      const stageDetails = [
        {
          id: 'box-1',
          title: 'Capture Demand',
          subtitle: 'Stage 01 · Capture',
          body: 'Landing pages, quizzes, and unique popup systems convert cold traffic visitors into contactable information.',
          cover: 'linear-gradient(135deg, #04261c, #12f39c)',
        },
        {
          id: 'box-2',
          title: 'Convert with AI',
          subtitle: 'Stage 02 · Catalyst AI',
          body: 'Our AI system pulls live Shopify and Klaviyo data to activate campaigns, personalized flows, and channels in real time.',
          cover: 'linear-gradient(135deg, #110f2b, #6d5bff)',
        },
        {
          id: 'box-3',
          title: 'Increase Customer LTV',
          subtitle: 'Stage 03 · Revenue',
          body: 'Revenue rooms surface cohort lift while automated win-back, VIP, and replenishment programs turn every touch into margin.',
          cover: 'linear-gradient(135deg, #271014, #ff6a3d)',
        },
      ];

      let activeDetailId = stageDetails[0]?.id || null;
      const detailList = document.getElementById('flow-detail-list');
      const detailCardEls = new Map();

      (function setupTheme() {
        function hexToRgba(hex, alpha) {
          const shorthandRegex = /^#?([a-f\d])([a-f\d])([a-f\d])$/i;
          const expanded = hex.replace(shorthandRegex, (m, r, g, b) => r + r + g + g + b + b);
          const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(expanded);
          const r = result ? parseInt(result[1], 16) : 255;
          const g = result ? parseInt(result[2], 16) : 255;
          const b = result ? parseInt(result[3], 16) : 255;
          return `rgba(${r}, ${g}, ${b}, ${alpha})`;
        }
        const root = document.documentElement;
        root.style.setProperty('--theme-color', MAIN_THEME_COLOR);
        root.style.setProperty('--theme-shadow-strong', hexToRgba(MAIN_THEME_COLOR, 0.2));
        root.style.setProperty('--theme-shadow-weak', hexToRgba(MAIN_THEME_COLOR, 0.1));
        root.style.setProperty('--theme-text-glow', hexToRgba(MAIN_THEME_COLOR, 0.6));
      })();

      const config = {
        trailLength: 500,
        lineWidth: 2,
        colors: {
          line: '#FFFFFF',
          glow: MAIN_THEME_COLOR,
        },
        boxBorderRadius: 20,
        easing: 0.15,
      };

      let width = 0;
      let height = 0;
      let boltY = -config.trailLength;
      let targetBoltY = boltY;
      let boxPositions = [];
      let sectionTop = 0;
      let sectionHeight = 1;
      let rafId = null;
      let streamCenterX = 0;
      let virtualScrollY = window.scrollY || 0;
      let pathSegments = [];

      function getBoxPositions() {
        const containerRect = container.getBoundingClientRect();
        const positions = boxes.map((box) => {
          const rect = box.getBoundingClientRect();
          return {
            top: rect.top - containerRect.top,
            bottom: rect.bottom - containerRect.top,
            height: rect.height,
            width: rect.width,
            offsetX: rect.width / 2,
            centerX: rect.left - containerRect.left + rect.width / 2,
          };
        });
        if (positions.length) {
          streamCenterX =
            positions.reduce((sum, pos) => sum + pos.centerX, 0) / positions.length;
        } else {
          streamCenterX = width / 2;
        }
        return positions;
      }

      function measureSection() {
        const rect = container.getBoundingClientRect();
        sectionTop = rect.top + virtualScrollY;
        sectionHeight = Math.max(rect.height, 1);
      }

      function resize() {
        width = container.offsetWidth;
        height = container.offsetHeight;
        canvas.width = width;
        canvas.height = height;
        boxPositions = getBoxPositions();
        buildPathSegments();
        measureSection();
        requestDraw();
      }

      window.addEventListener('resize', resize);
      resize();

      function clamp(value, min, max) {
        return Math.min(max, Math.max(min, value));
      }

      function updateScrollProgress() {
        const triggerLine = virtualScrollY + window.innerHeight * 0.5;
        const triggerStart = sectionTop;
        const totalTravel = Math.max(height + config.trailLength, 1);
        const rawProgress = (triggerLine - triggerStart) / totalTravel;
        const progress = clamp(rawProgress, 0, 1);
        targetBoltY = progress * (height + config.trailLength);
        requestDraw();
      }

      function handleScrollInput(scrollValue) {
        if (typeof scrollValue === 'number') {
          virtualScrollY = scrollValue;
        } else {
          virtualScrollY = window.scrollY || 0;
        }
        updateScrollProgress();
      }

      window.addEventListener('scroll', () => handleScrollInput(), { passive: true });
      window.addEventListener('loco-scroll', (event) => {
        if (event.detail && event.detail.scroll) {
          handleScrollInput(event.detail.scroll.y);
        }
      });
      handleScrollInput(virtualScrollY);

      function renderDetailCards() {
        if (!detailList) return;
        detailList.innerHTML = '';
        detailCardEls.clear();
        stageDetails.forEach((item) => {
          const card = document.createElement('article');
          const extraClass = item.id === 'box-1' ? ' flow-detail-card--capture' : '';
          card.className = `flow-detail-card${extraClass}`;
          const coverHtml =
            item.id === 'box-2'
              ? `<div class="flow-detail-card__cover flow-detail-card__cover--ai-video">
                  <video class="ai-video" src="assets/videos/vercel_loop.mp4" autoplay muted loop playsinline poster="" aria-label="Catalyst AI orchestration video"></video>
                  <div class="ai-video__overlay"></div>
                </div>`
              : item.id === 'box-3'
              ? `<div class="flow-detail-card__cover flow-detail-card__cover--results">
                  <img src="assets/images/klaviyo-results.png" alt="Klaviyo results dashboard" class="flow-detail-card__image" />
                </div>`
              : `<div class="flow-detail-card__cover" style="background-image:${item.cover};">
                  ${item.id === 'box-1' ? '<img src="assets/images/pop-ups-cut.png" alt="Pop ups" class="flow-detail-card__graphic" />' : ''}
                </div>`;
          card.innerHTML = `
            ${coverHtml}
            <div class="flow-detail-card__meta">
              <p class="flow-detail-card__subtitle">${item.subtitle}</p>
              <h3 class="flow-detail-card__title">${item.title}</h3>
              <p class="flow-detail-card__body">${item.body}</p>
            </div>
          `;
          detailList.appendChild(card);
          detailCardEls.set(item.id, card);
        });
        if (window.__locoScroll && typeof window.__locoScroll.update === 'function') {
          window.__locoScroll.update();
        }
      }

      renderDetailCards();

      function setDetailContent(id) {
        const detail = stageDetails.find((item) => item.id === id);
        if (!detail) return;
        activeDetailId = detail.id;
        detailCardEls.forEach((card, key) => {
          if (key === id) card.classList.add('is-active');
          else card.classList.remove('is-active');
        });
      }

      setDetailContent(activeDetailId);

      function requestDraw() {
        if (rafId) return;
        rafId = requestAnimationFrame(draw);
      }

      function draw() {
        rafId = null;
        const diff = targetBoltY - boltY;
        if (Math.abs(diff) > 0.5) {
          boltY += diff * config.easing;
          requestDraw();
        } else {
          boltY = targetBoltY;
        }
        render();
      }

      function render() {
        ctx.clearRect(0, 0, width, height);
        if (boltY <= 0) return;

        const startY = Math.max(0, boltY - config.trailLength);
        const endY = Math.min(height, boltY);
        drawStreams(startY, endY);
        updateBoxStates();
      }

      function drawStreams(startY, endY) {
        if (endY <= startY || !pathSegments.length) return;
        const gradient = ctx.createLinearGradient(0, startY, 0, endY);
        gradient.addColorStop(0, 'rgba(255,255,255,0)');
        gradient.addColorStop(0.2, 'rgba(255,255,255,0.1)');
        gradient.addColorStop(0.8, config.colors.line);
        gradient.addColorStop(1, '#FFFFFF');

        ctx.strokeStyle = gradient;
        ctx.lineWidth = config.lineWidth;
        ctx.lineCap = 'round';
        ctx.lineJoin = 'round';
        ctx.shadowBlur = 10;
        ctx.shadowColor = config.colors.glow;

        ctx.save();
        ctx.beginPath();
        ctx.rect(0, startY, width, endY - startY);
        ctx.clip();

        ctx.beginPath();
        pathSegments.forEach((segment, index) => {
          if (segment.type === 'move') {
            ctx.moveTo(segment.x, segment.y);
          } else if (segment.type === 'line') {
            ctx.lineTo(segment.x, segment.y);
          } else if (segment.type === 'arc') {
            ctx.arcTo(segment.cpx, segment.cpy, segment.x, segment.y, segment.radius);
          }
        });

        ctx.stroke();
        ctx.restore();
        ctx.shadowBlur = 0;
      }

      function buildPathSegments() {
        const centerX = streamCenterX || width / 2;
        pathSegments = [];
        pathSegments.push({ type: 'move', x: centerX, y: 0 });

        boxPositions.forEach((box) => {
          const top = box.top;
          const bottom = box.bottom;
          const radius = Math.min(config.boxBorderRadius, box.offsetX, box.height / 2);
          const leftInner = centerX - box.offsetX + radius;
          const leftEdge = centerX - box.offsetX;
          const rightInner = centerX + box.offsetX - radius;
          const rightEdge = centerX + box.offsetX;

          pathSegments.push({ type: 'line', x: centerX, y: top });
          pathSegments.push({ type: 'line', x: leftInner, y: top });
          pathSegments.push({
            type: 'arc',
            cpx: leftEdge,
            cpy: top,
            x: leftEdge,
            y: top + radius,
            radius,
          });
          pathSegments.push({ type: 'line', x: leftEdge, y: bottom - radius });
          pathSegments.push({
            type: 'arc',
            cpx: leftEdge,
            cpy: bottom,
            x: leftInner,
            y: bottom,
            radius,
          });
          pathSegments.push({ type: 'line', x: centerX, y: bottom });

          pathSegments.push({ type: 'move', x: centerX, y: top });
          pathSegments.push({ type: 'line', x: rightInner, y: top });
          pathSegments.push({
            type: 'arc',
            cpx: rightEdge,
            cpy: top,
            x: rightEdge,
            y: top + radius,
            radius,
          });
          pathSegments.push({ type: 'line', x: rightEdge, y: bottom - radius });
          pathSegments.push({
            type: 'arc',
            cpx: rightEdge,
            cpy: bottom,
            x: rightInner,
            y: bottom,
            radius,
          });
          pathSegments.push({ type: 'line', x: centerX, y: bottom });

          currentY = bottom;
        });

        pathSegments.push({ type: 'line', x: centerX, y: height });
      }

      function updateBoxStates() {
        let currentDetail = activeDetailId || stageDetails[0]?.id;
        const tolerance = 10;
        boxPositions.forEach((pos, index) => {
          if (boltY > pos.bottom) boxes[index].classList.add('active');
          else boxes[index].classList.remove('active');

          if (boltY >= pos.top - tolerance) {
            currentDetail = boxes[index].id;
          }
        });
        if (currentDetail && currentDetail !== activeDetailId) {
          setDetailContent(currentDetail);
        }
      }
    })();
  </script>
</body>
</html>
